<div class="row">
  <table class="col s12 highlight centered">
    <thead>
      <tr>
        <th>Budget Category</th>
        <th>Total Estimated</th>
        <th>Current Actual Total</th>
      </tr>
    <tbody>
      <tr>
        <td><a href="/budgetdetails/income">Income</a></td>
        <td>$<%=expectedIncome%></td>
        <td>$<%= totalIncome %></td>
      </tr>
      <tr>
        <td><a href="/budgetdetails/firm-expense">Firm Expense</a></td>
        <td>$<%=expectedFirmExpenses%></td>
        <td class="<%=actualFirmExpenseColorClass%>">
          $<%=firmExpenseTotal%>
        </td>
      </tr>
      <tr>
        <td><a href="/budgetdetails/flex-expense">Flex Expense</a></td>
        <td>$<%=expectedFlexExpenses%></td>
        <td class="<%=actualFlexExpenseColorClass%>">
          $<%=flexExpenseTotal%>
        </td>
      </tr>
    </tbody>
  </table>
</div>
<% 
// functions
const calculateTotal = (Itemcategory) => {
  let total = 0;
  for (budgetItem of budgetdetails) {
    if(budgetItem.category === Itemcategory) {
      total += parseInt(budgetItem.amount);
    }
  }
  return total;
};

const calculateMultipleTotals = (itemcategory1, itemcategory2) => {
  let total = 0;
  for (budgetItem of budgetdetails) {
    if(budgetItem.category === itemcategory1 || budgetItem.category === itemcategory2) {
      total += parseInt(budgetItem.amount);
    }
  }
  return total;
};

// variables
const totalIncome = calculateTotal('income');
const firmExpenseTotal = calculateTotal('firm-expense');
const flexExpenseTotal = calculateTotal('flex-expense');
const expectedIncome = budgetplan[0].expectedincome;
const expectedFirmExpenses = budgetplan[0].expectedfirmexpenses;
const expectedFlexExpenses = budgetplan[0].expectedflexexpenses;
const totalExpectedExpense = parseInt(expectedFirmExpenses) + parseInt(expectedFlexExpenses);
const incomepercentage = 100 / (expectedIncome / totalIncome)
const firmpercentage = 100 / (expectedFirmExpenses / firmExpenseTotal)
const flexpercentage = 100 / (expectedFlexExpenses / flexExpenseTotal)
%>


<dl>
  <dt>Check How Your Budget's Doing: </dt>
  <dd class="percentage percentage-100"><span class="text">Expected Income: $<%= expectedIncome %></span></dd>
  <dd class="percentage percentage-<%=incomepercentage%>"><span class="text">Current Income Earned:
      $<%=totalIncome %></span></dd>
  <dd class="percentage percentage-100"><span class="text">Expected Firm Expenses: $<%=expectedFirmExpenses%></span>
  </dd>
  <dd class="percentage percentage-<%=firmpercentage%>"><span class="text">Current Firm Expenses:
      $<%=firmExpenseTotal%></span></dd>
  <dd class="percentage percentage-100"><span class="text">Expected Flex Expenses: $<%=expectedFlexExpenses%></span>
  </dd>
  <dd class="percentage percentage-<%=flexpercentage%>"><span class="text">Current Flex Expenses:
      $<%=flexExpenseTotal%></span></dd>
</dl>